 @page "/tests"

<h3>Тесты</h3>

<button class="btn btn-primary" @onclick="RunTests">Запустить тесты</button>

<p>Результаты тестов:</p>
<ul>
    @foreach (var result in testResults)
    {
        <li>@result</li>
    }
</ul>

@code {
    private List<string> testResults = new List<string>();

    private async Task RunTests()
    {
        Console.WriteLine("Кнопка нажата!");

        var textGenerator = new RandomTextGenerator();
        var forumEditor = new ForumEditor(textGenerator);

        // Тест 1: Генерация случайного текста
        var generatedText = textGenerator.GenerateRandomText(100);
        AppendTestResult($"Тест 1: Генерация случайного текста - {(!string.IsNullOrWhiteSpace(generatedText)).ToString()}");

        // Тест 2: Сохранение в файл
        forumEditor.GenerateRandomText();
        await forumEditor.SaveToFile();
        var fileContent = await File.ReadAllTextAsync("textFile.txt");
        AppendTestResult($"Тест 2: Сохранение в файл - {(fileContent == forumEditor.TextContent).ToString()}");

        // Тест 3: Загрузка из файла
        await forumEditor.LoadFromFile();
        AppendTestResult($"Тест 3: Загрузка из файла - {(forumEditor.TextContent == fileContent).ToString()}");

    }

    private void AppendTestResult(string result)
    {
        testResults.Add(result);
    }

    public class RandomTextGenerator
    {
        private static readonly string[] letters = { "a", "b", "c", "d", "e", "f", "g", "h", "i", "j", "k", "l", "l", "n", "m", "o", "p", "q", "r" };

        public string GenerateRandomText(int numberOfWords)
        {
            Random random = new Random();
            string generatedText = "";

            for (int i = 0; i < numberOfWords; i++)
            {
                int randomIndex = random.Next(0, letters.Length);
                generatedText += letters[randomIndex] + "";
            }

            return generatedText.Trim();
        }
    }

    public class ForumEditor
    {
        private readonly RandomTextGenerator textGenerator;

        public ForumEditor(RandomTextGenerator textGenerator)
        {
            this.textGenerator = textGenerator;
        }

        private string textContent = "";

        public string TextContent
        {
            get => textContent;
            set => textContent = value;
        }

        public void GenerateRandomText()
        {
            TextContent = textGenerator.GenerateRandomText(100);
        }

        public async Task SaveToFile()
        {
            await File.WriteAllTextAsync("textFile.txt", TextContent);
        }

        public async Task LoadFromFile()
        {
            if (File.Exists("textFile.txt"))
            {
                TextContent = await File.ReadAllTextAsync("textFile.txt");
            }
            else
            {
                TextContent = "Файл не найден";
            }
        }

        public void DeleteFile()
        {
            if (File.Exists("textFile.txt"))
            {
                File.Delete("textFile.txt");
                TextContent = "Файл Удален";
            }
            else
            {
                TextContent = "Файл не найден";
            }
        }
    }
}
